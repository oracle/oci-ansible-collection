## Create/Launch Instance Pool
- name: Create a new basic compute instance configuration that only has launch_details and VNIC configuration
  oci_compute_management_instance_configuration:
    compartment_id: "{{test_compartment_ocid}}"
    name: "{{test_instance_configuration_name}}"
    instance_details:
      instance_type: "compute"
      launch_details:
        compartment_id: "{{test_compartment_ocid}}"
        create_vnic_details:
          assign_public_ip: True
          display_name: "{{test_instance_name}}"
          skip_source_dest_check: False
        display_name: "{{test_instance_name}}"
        shape: "{{ test_instance_shape }}"
        source_details:
          source_type: "image"
          image_id: "{{image_ocid}}"
  register: result

- set_fact:
    my_instance_config_id: "{{result.instance_configuration.id}}"

- name: Create a new instance pool from this instance configuration
  oci_compute_management_instance_pool:
    name: "{{test_instance_pool_name}}"
    compartment_id: "{{test_compartment_ocid}}"
    instance_configuration_id: "{{my_instance_config_id}}"
    size: 1
    placement_configurations:
    - availability_domain: "{{test_availability_domain}}"
      primary_subnet_id: "{{common_subnet_id}}"
  register: result

- set_fact:
    my_instance_pool_id: "{{result.instance_pool.id}}"
    dependency_id: "{{result.instance_pool.id}}"

- name: Assert that changed is true
  assert:
    that:
    - result.changed == True
    - result.instance_pool.display_name == "{{test_instance_pool_name}}"
    - result.instance_pool.lifecycle_state == "RUNNING"