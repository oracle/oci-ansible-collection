---
- block:
  - set_fact:
      test_original_authentication_policy_update_optional_required_password_policy:
        minimum_password_length: 12
        is_uppercase_characters_required: True
        is_lowercase_characters_required: True
        is_numeric_characters_required: True
        is_special_characters_required: True

  - set_fact:
      test_updated_authentication_policy_update_optional_required_password_policy:
        minimum_password_length: 12
        is_uppercase_characters_required: False
        is_lowercase_characters_required: False
        is_numeric_characters_required: False
        is_special_characters_required: False

  - name: Update authentication_policy with optional + required parameters
    oci_identity_authentication_policy:
      compartment_id: "{{ tenancy_ocid }}"
      password_policy: "{{ test_updated_authentication_policy_update_optional_required_password_policy }}"
    register: result

  - name: Assert resource was updated
    assert:
      that:
        - result.changed == True

# ==================================================================================================== #

  - name: Update authentication_policy with optional + required parameters (idempotence)
    oci_identity_authentication_policy:
      compartment_id: "{{ tenancy_ocid }}"
      password_policy: "{{ test_updated_authentication_policy_update_optional_required_password_policy }}"
    register: result

  - name: Assert changed is False
    assert:
      that:
        - result.changed == False

# ==================================================================================================== #

  - name: Get authentication_policy
    oci_identity_authentication_policy_facts:
      compartment_id: "{{ tenancy_ocid }}"
    register: result

  - name: Assert resource was listed
    assert:
      that:
        - result.authentication_policy is defined
        - result.authentication_policy != None

  always:
    - name: Update authentication_policy back to default
      oci_identity_authentication_policy:
        compartment_id: "{{ tenancy_ocid }}"
        password_policy: "{{ test_original_authentication_policy_update_optional_required_password_policy }}"
      register: result