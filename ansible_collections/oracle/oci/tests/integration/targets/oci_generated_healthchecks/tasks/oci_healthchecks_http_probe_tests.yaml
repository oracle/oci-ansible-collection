---
- block:
  - name: Create http_probe (check mode)
    oci_healthchecks_http_probe:
      compartment_id: "{{ test_compartment_ocid | oracle.oci.override(test_http_probe_create_required_compartment_id, omit) }}"
      targets: "{{ [ '192.0.2.0' ] | oracle.oci.override(test_http_probe_create_required_targets, omit) }}"
      protocol: "{{ 'HTTP' | oracle.oci.override(test_http_probe_create_required_protocol, omit) }}"
    register: result
    check_mode: yes
    when: skip_http_probe_create_check_mode_test is not defined

  - name: Assert resource would have been created
    assert:
      that:
        - result.changed == True
    when: skip_http_probe_create_check_mode_test is not defined

  - name: Assert custom assertions
    assert:
      that:
        - "{{ item }}"
    with_items: "{{ http_probe_create_check_mode_custom_assertions }}"
    when: http_probe_create_check_mode_custom_assertions is defined

# ==================================================================================================== #

  - name: Create http_probe with required parameters
    oci_healthchecks_http_probe:
      compartment_id: "{{ test_compartment_ocid | oracle.oci.override(test_http_probe_create_required_compartment_id, omit) }}"
      targets: "{{ [ '192.0.2.0' ] | oracle.oci.override(test_http_probe_create_required_targets, omit) }}"
      protocol: "{{ 'HTTP' | oracle.oci.override(test_http_probe_create_required_protocol, omit) }}"
    register: result
    when: skip_http_probe_create_required_original_test is not defined

  - name: Assert resource was created
    assert:
      that:
        - result.changed == True
    when: skip_http_probe_create_required_original_test is not defined

  - set_fact:
      http_probe_resource_id: "{{ result.http_probe.id }}"
    when: skip_http_probe_create_required_original_test is not defined

  - name: Assert response properties are populated
    assert:
      that:
        - result.http_probe.id is defined
        - result.http_probe.results_url is defined
        - result.http_probe.home_region is defined
        - result.http_probe.time_created is defined
        - result.http_probe.compartment_id is defined
        - result.http_probe.targets is defined
        - result.http_probe.vantage_point_names is defined
        - result.http_probe.port is defined
        - result.http_probe.timeout_in_seconds is defined
        - result.http_probe.protocol is defined
        - result.http_probe.method is defined
        - result.http_probe.path is defined
        - result.http_probe.headers is defined
    when: skip_http_probe_create_required_original_test is not defined

  - name: Assert custom assertions
    assert:
      that:
        - "{{ item }}"
    with_items: "{{ http_probe_create_required_original_custom_assertions }}"
    when: http_probe_create_required_original_custom_assertions is defined

# ==================================================================================================== #

  - name: Re-create http_probe with required parameters(idempotency)
    oci_healthchecks_http_probe:
      compartment_id: "{{ test_compartment_ocid | oracle.oci.override(test_http_probe_create_required_compartment_id, omit) }}"
      targets: "{{ [ '192.0.2.0' ] | oracle.oci.override(test_http_probe_create_required_targets, omit) }}"
      protocol: "{{ 'HTTP' | oracle.oci.override(test_http_probe_create_required_protocol, omit) }}"
    register: result
    when: skip_http_probe_create_required_idempotency_test is not defined

  - name: Assert changed is False
    assert:
      that:
        - result.changed == False
    when: skip_http_probe_create_required_idempotency_test is not defined

  - name: Assert response properties are populated
    assert:
      that:
        - result.http_probe.id is defined
        - result.http_probe.results_url is defined
        - result.http_probe.home_region is defined
        - result.http_probe.time_created is defined
        - result.http_probe.compartment_id is defined
        - result.http_probe.targets is defined
        - result.http_probe.vantage_point_names is defined
        - result.http_probe.port is defined
        - result.http_probe.timeout_in_seconds is defined
        - result.http_probe.protocol is defined
        - result.http_probe.method is defined
        - result.http_probe.path is defined
        - result.http_probe.headers is defined
    when: skip_http_probe_create_required_idempotency_test is not defined

  - name: Assert custom assertions
    assert:
      that:
        - "{{ item }}"
    with_items: "{{ http_probe_create_required_idempotency_custom_assertions }}"
    when: http_probe_create_required_idempotency_custom_assertions is defined

# ==================================================================================================== #

  - name: Create http_probe with optional + required parameters
    oci_healthchecks_http_probe:
      compartment_id: "{{ test_compartment_ocid | oracle.oci.override(test_http_probe_create_optional_required_compartment_id, omit) }}"
      targets: "{{ [ '192.0.2.0' ] | oracle.oci.override(test_http_probe_create_optional_required_targets, omit) }}"
      vantage_point_names: "{{ [ 'null' ] | oracle.oci.override(test_http_probe_create_optional_required_vantage_point_names, omit) }}"
      port: "{{ 56 | oracle.oci.override(test_http_probe_create_optional_required_port, omit) }}"
      timeout_in_seconds: "{{ 56 | oracle.oci.override(test_http_probe_create_optional_required_timeout_in_seconds, omit) }}"
      protocol: "{{ 'HTTP' | oracle.oci.override(test_http_probe_create_optional_required_protocol, omit) }}"
      method: "{{ 'GET' | oracle.oci.override(test_http_probe_create_optional_required_method, omit) }}"
      path: "{{ 'path_example' | oracle.oci.override(test_http_probe_create_optional_required_path, omit) }}"
      headers: "{{ null | oracle.oci.override(test_http_probe_create_optional_required_headers, omit) }}"
    register: result
    when: skip_http_probe_create_optional_required_original_test is not defined

  - name: Assert changed is True
    assert:
      that:
        - result.changed == True
    when: skip_http_probe_create_optional_required_original_test is not defined

  - set_fact:
      http_probe_resource_id: "{{ result.http_probe.id }}"
    when: skip_http_probe_create_optional_required_original_test is not defined

  - name: Assert response properties are populated
    assert:
      that:
        - result.http_probe.id is defined
        - result.http_probe.results_url is defined
        - result.http_probe.home_region is defined
        - result.http_probe.time_created is defined
        - result.http_probe.compartment_id is defined
        - result.http_probe.targets is defined
        - result.http_probe.vantage_point_names is defined
        - result.http_probe.port is defined
        - result.http_probe.timeout_in_seconds is defined
        - result.http_probe.protocol is defined
        - result.http_probe.method is defined
        - result.http_probe.path is defined
        - result.http_probe.headers is defined
    when: skip_http_probe_create_optional_required_original_test is not defined

  - name: Assert custom assertions
    assert:
      that:
        - "{{ item }}"
    with_items: "{{ http_probe_create_optional_required_original_custom_assertions }}"
    when: http_probe_create_optional_required_original_custom_assertions is defined

# ==================================================================================================== #

  - name: Re-create http_probe with optional + required parameters (idempotence)
    oci_healthchecks_http_probe:
      compartment_id: "{{ test_compartment_ocid | oracle.oci.override(test_http_probe_create_optional_required_compartment_id, omit) }}"
      targets: "{{ [ '192.0.2.0' ] | oracle.oci.override(test_http_probe_create_optional_required_targets, omit) }}"
      vantage_point_names: "{{ [ 'null' ] | oracle.oci.override(test_http_probe_create_optional_required_vantage_point_names, omit) }}"
      port: "{{ 56 | oracle.oci.override(test_http_probe_create_optional_required_port, omit) }}"
      timeout_in_seconds: "{{ 56 | oracle.oci.override(test_http_probe_create_optional_required_timeout_in_seconds, omit) }}"
      protocol: "{{ 'HTTP' | oracle.oci.override(test_http_probe_create_optional_required_protocol, omit) }}"
      method: "{{ 'GET' | oracle.oci.override(test_http_probe_create_optional_required_method, omit) }}"
      path: "{{ 'path_example' | oracle.oci.override(test_http_probe_create_optional_required_path, omit) }}"
      headers: "{{ null | oracle.oci.override(test_http_probe_create_optional_required_headers, omit) }}"
    register: result
    when: skip_http_probe_create_optional_required_idempotence_test is not defined

  - name: Assert changed is False
    assert:
      that:
        - result.changed == False
    when: skip_http_probe_create_optional_required_idempotence_test is not defined

  - name: Assert response properties are populated
    assert:
      that:
        - result.http_probe.id is defined
        - result.http_probe.results_url is defined
        - result.http_probe.home_region is defined
        - result.http_probe.time_created is defined
        - result.http_probe.compartment_id is defined
        - result.http_probe.targets is defined
        - result.http_probe.vantage_point_names is defined
        - result.http_probe.port is defined
        - result.http_probe.timeout_in_seconds is defined
        - result.http_probe.protocol is defined
        - result.http_probe.method is defined
        - result.http_probe.path is defined
        - result.http_probe.headers is defined
    when: skip_http_probe_create_optional_required_idempotence_test is not defined

  - name: Assert custom assertions
    assert:
      that:
        - "{{ item }}"
    with_items: "{{ http_probe_create_optional_required_idempotence_custom_assertions }}"
    when: http_probe_create_optional_required_idempotence_custom_assertions is defined

  always:
    - debug:
        msg: "Nothing to clean up since this resource does not have delete operation and also no dependencies."
