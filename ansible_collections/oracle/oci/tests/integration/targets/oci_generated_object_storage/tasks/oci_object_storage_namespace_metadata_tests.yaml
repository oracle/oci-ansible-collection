---
- block:
  - name: Update namespace_metadata with optional + required parameters
    oci_object_storage_namespace_metadata:
      namespace_name: "{{ test_namespace_name | oracle.oci.override(test_namespace_metadata_update_optional_required_namespace_name, omit) }}"
      default_s3_compartment_id: "{{ dependency_default_s3_compartment_id | oracle.oci.override(test_namespace_metadata_update_optional_required_default_s3_compartment_id, omit) }}"
      default_swift_compartment_id: "{{ dependency_default_swift_compartment_id | oracle.oci.override(test_namespace_metadata_update_optional_required_default_swift_compartment_id, omit) }}"
    register: result
    when: skip_namespace_metadata_update_optional_required_test is not defined

  - name: Assert resource was updated
    assert:
      that:
        - result.changed == True
    when: skip_namespace_metadata_update_optional_required_test is not defined

  - name: Assert response properties are populated
    assert:
      that:
        - result.namespace_metadata.namespace is defined
        - result.namespace_metadata.default_s3_compartment_id is defined
        - result.namespace_metadata.default_swift_compartment_id is defined
    when: skip_namespace_metadata_update_optional_required_test is not defined

  - name: Assert custom assertions
    assert:
      that:
        - "{{ item }}"
    with_items: "{{ namespace_metadata_update_optional_required_custom_assertions }}"
    when: namespace_metadata_update_optional_required_custom_assertions is defined

# ==================================================================================================== #

  - name: Update namespace_metadata with optional + required parameters (idempotence)
    oci_object_storage_namespace_metadata:
      namespace_name: "{{ test_namespace_name | oracle.oci.override(test_namespace_metadata_update_optional_required_namespace_name, omit) }}"
      default_s3_compartment_id: "{{ dependency_default_s3_compartment_id | oracle.oci.override(test_namespace_metadata_update_optional_required_default_s3_compartment_id, omit) }}"
      default_swift_compartment_id: "{{ dependency_default_swift_compartment_id | oracle.oci.override(test_namespace_metadata_update_optional_required_default_swift_compartment_id, omit) }}"
    register: result
    when: skip_namespace_metadata_update_optional_required_idempotence_test is not defined

  - name: Assert changed is False
    assert:
      that:
        - result.changed == False
    when: skip_namespace_metadata_update_optional_required_idempotence_test is not defined

  - name: Assert response properties are populated
    assert:
      that:
        - result.namespace_metadata.namespace is defined
        - result.namespace_metadata.default_s3_compartment_id is defined
        - result.namespace_metadata.default_swift_compartment_id is defined
    when: skip_namespace_metadata_update_optional_required_idempotence_test is not defined

  - name: Assert custom assertions
    assert:
      that:
        - "{{ item }}"
    with_items: "{{ namespace_metadata_update_optional_required_idempotence_custom_assertions }}"
    when: namespace_metadata_update_optional_required_idempotence_custom_assertions is defined

# ==================================================================================================== #

  - name: Get namespace_metadata
    oci_object_storage_namespace_metadata_facts:
      namespace_name: "{{ test_namespace_name | oracle.oci.override(test_namespace_metadata_get_namespace_name, omit) }}"
    register: result
    when: skip_namespace_metadata_get_test is not defined

  - name: Assert resource was listed
    assert:
      that:
        - result.namespace_metadata is defined
        - result.namespace_metadata != None
    when: skip_namespace_metadata_get_test is not defined

  - name: Assert response properties are populated
    assert:
      that:
        - item.namespace is defined
        - item.default_s3_compartment_id is defined
        - item.default_swift_compartment_id is defined
    with_items:
      - "{{ result.namespace_metadata }}"
    when: skip_namespace_metadata_get_test is not defined

  - name: Assert custom assertions
    assert:
      that:
        - "{{ item }}"
    with_items: "{{ namespace_metadata_get_custom_assertions }}"
    when: namespace_metadata_get_custom_assertions is defined

  always:
    - debug:
        msg: "Nothing to clean up since this resource does not have delete operation and also no dependencies."
