- name: Create network_security_group
  oci_network_security_group:
    compartment_id: "{{ test_compartment_ocid }}"
    display_name: "setup_windows_{{random_suffix_1024}}"
    vcn_id: "{{ common_vcn_id }}"
  register: result

- set_fact:
    setup_windows_instance_nsg_id: "{{result.network_security_group.id}}"

## Create/Launch
- name: Create new windows compute instance
  oci_compute_instance:
    name: "windows-{{test_instance_name}}"
    shape: "{{test_instance_shape}}"
    compartment_id: "{{test_compartment_ocid}}"
    availability_domain: "{{test_availability_domain_2}}"
    source_details:
      source_type: "image"
      image_id: "{{windows_image_ocid}}"
    create_vnic_details:
        hostname_label: "windows-{{test_instance_name}}"
        subnet_id: "{{common_subnet_id}}"
        nsg_ids:
          - "{{ setup_windows_instance_nsg_id }}"
  register: result
# name: Set variable to current instance id
- set_fact:
    setup_windows_instance_id: "{{ result.instance.id }}"
- debug:
    msg: "{{ result }}"
