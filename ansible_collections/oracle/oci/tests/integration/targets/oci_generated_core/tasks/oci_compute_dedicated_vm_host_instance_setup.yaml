- name: Create a dedicated vm host
  oci_compute_dedicated_vm_host:
    availability_domain: "{{ test_availability_domain }}"
    compartment_id: "{{ test_compartment_ocid }}"
    dedicated_vm_host_shape: "{{ dedicated_vm_host_shape }}"
    display_name: "test-dedicated-vm-host-{{random_suffix_1024}}"
  register: result
- set_fact:
    setup_dedicated_vm_host_id: "{{ result.dedicated_vm_host.id }}"
- name: Create new compute instance in dedicated host
  oci_compute_instance:
    display_name: "dvh-{{test_instance_name}}"
    shape: "{{test_instance_shape}}"
    compartment_id: "{{test_compartment_ocid}}"
    availability_domain: "{{test_availability_domain}}"
    source_details:
      source_type: "image"
      image_id: "{{image_ocid}}"
    create_vnic_details:
      hostname_label: "{{test_instance_name}}"
      subnet_id: "{{common_subnet_id}}"
    dedicated_vm_host_id: "{{ setup_dedicated_vm_host_id }}"
  register: result
- set_fact:
    dedicated_vm_host_instance_id: "{{ result.instance.id }}"