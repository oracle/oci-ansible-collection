- block:
  - debug:
      msg="Using random_suffix_250 {{random_suffix_250 }} and random_suffix_1024 {{random_suffix_1024}}"

  - name: Get all services
    oci_network_service_facts:
    register: result

  - set_fact:
      service_resource_id: "{{ result.services[0].id }}"
      dependency_service_id: "{{ result.services[0].id }}"
      all_services: "{{ result.services }}"

  # Compute the AD to create compute instances in
  - oci_identity_availability_domain_facts:
      compartment_id: "{{test_compartment_ocid}}"
    register: oci_ads
  - set_fact:
      test_availability_domain: "{{oci_ads.availability_domains[0].name}}"
      test_availability_domain_2: "{{oci_ads.availability_domains[1].name}}"
      test_availability_domain_3: "{{oci_ads.availability_domains[2].name}}"
  - debug: msg="First AD within the ashburn region {{test_availability_domain}}"
  - debug: msg="Second AD within the ashburn region {{test_availability_domain_2}}"

  # create a vcn here instead of creating it multiple times in various tests.
  # Since ansible does not provide a way to define a post-execution role, there is no optimal way to delete this vcn
  # after the tests. But since the modules are idempotent(ideally!) we will not be creating this every time a test is run.
  # The vcn has the following configuration:
  # CIDR Block: 10.0.0.0/16
  # Security Lists: Default security list with no security rules
  # Has an internet gateway, service gateway
  # Route tables: Default route table with all out going traffic pointed to internet gateway
  - import_tasks: setup_vcn.yaml
    tags:
      - setup_vcn

  # Get and set the fast connect provider details so that the tests which it as a dependency work
  - name: List fast_connect_provider_services
    oci_network_fast_connect_provider_service_facts:
      compartment_id: "{{ test_compartment_ocid }}"
    register: result

  - set_fact:
      dependency_provider_service_id: "{{ result.fast_connect_provider_services[0].id }}"

  tags:
    - always