---
# Variables that we don't expect to be overridden per test environment

# generate a random number upto 1024 seeded by the hostname
# so that concurrent runs don't collide.
# We seed the RNG with the nodename so that all test runs that originate from
# a hostname use the same value, and it would be easier for us to debug issues.
random_suffix_1024: "{{1024 |random(seed=ansible_nodename)}}"

# For IP scenarios, allocate in blocks of ten, so that any secondary vnic ip
# addresses that are created by adding to the primary IP, will not result in
# conflicts across machines
random_suffix_250: "{{ 250 | random(seed=ansible_nodename, step=10) }}"

# Note: instance name (because they are used as DNS hostname labels cannot have underscores.
# see https://en.wikipedia.org/wiki/Hostname#Restrictions_on_valid_hostnames
test_instance_name: "ansible-test-instance-{{random_suffix_1024}}"
test_instance_boot_volume_size_in_gbs: 100
test_mod_instance_name: "ansible-test-modname-instance-{{random_suffix_1024}}"
test_windows_instance_name: "ansible-test-windows-instance-{{random_suffix_1024}}"
test_app_catalog_instance_name: "ansible-test-app-catalog-instance-{{random_suffix_1024}}"

test_private_ip: "10.0.0.{{random_suffix_250}}"

# Tag namespaces
test_tag_namespace_name: "ansible_tag_namespace_integration_test_1"
test_tag_namespace_name_for_iam: "ansible_tag_namespace_integration_test_for_iam_1"
test_tag_namespace_description: "{{test_tag_namespace_name}} description"
test_tag_namespace_mod_description: "{{test_tag_namespace_name}} modified description"

# Tag key definitions
test_tag_name: "ansible_tag_1"
test_tag_description: "{{test_tag_name}} description"
test_tag_mod_description: "{{test_tag_name}} modified description"

# Ensure that the tag under {{test_tag_namespace_ocid}} with the name {{test_tag_name}} exists before running tests.

my_freeform_test_tag_key: "test_freeform_tag_{{random_suffix_250}}"
my_freeform_test_tag_value: "test_freeform_tag_{{random_suffix_250}}_value"

# waas specific variables
waas_policy_origin_name: primary
waas_policy_origins:
  primary:
    custom_headers: []
    http_port: 80
    https_port: 443
    uri: 1.2.3.4

updated_waas_policy_origins:
  primary:
    custom_headers: []
    http_port: 80
    https_port: 443
    uri: 1.2.3.4
  secondary:
    custom_headers: []
    http_port: 80
    https_port: 443
    uri: 2.3.4.5
  third:
    custom_headers: []
    http_port: 80
    https_port: 443
    uri: 3.4.5.6

updated_waas_policy_origin_name: secondary
waas_block_action: "BLOCK"

waf_config_access_rules:
- action: "ALLOW"
  criteria:
  - condition: "URL_IS"
    value: "/public"
  name: "ansibletestaccessrule"
  block_action: "SET_RESPONSE_CODE"
  block_error_page_code: "403"
  block_error_page_description: "blockErrorPageDescription"
  block_error_page_message: "blockErrorPageMessage"
  block_response_code: 403

waf_config_address_rate_limiting:
  is_enabled: True
  allowed_rate_per_address: 10
  block_response_code: 403
  max_delayed_count_per_address: 10

waf_config_captchas:
  - failure_message: "message"
    session_expiration_in_seconds: 10
    submit_label: "label"
    title: "title"
    url: "url"
    footer_text: "footer_text"
    header_text: "header_text"

waf_config_device_fingerprint_challenge:
  is_enabled: True
  action: "DETECT"
  action_expiration_in_seconds: 10

  challenge_settings:
    block_action: "SET_RESPONSE_CODE"
    block_error_page_code: "403"
    block_error_page_description: "blockErrorPageDescription"
    block_error_page_message: "blockErrorPageMessage"
    block_response_code: 403
    captcha_footer: "captchaFooter"
    captcha_header: "captchaHeader"
    captcha_submit_label: "captchaSubmitLabel"
    captcha_title: "captchaTitle"

  failure_threshold: 10
  failure_threshold_expiration_in_seconds: 10
  max_address_count: 10
  max_address_count_expiration_in_seconds: 10

waf_config_good_bots:
  - description: test good bot
    is_enabled: True
    key: testgoodbot
    name: test good bot

waf_config_human_interaction_challenge:
  is_enabled: True
  action: "DETECT"
  action_expiration_in_seconds: 10

  challenge_settings:
    block_action: "SET_RESPONSE_CODE"
    block_error_page_code: "403"
    block_error_page_description: "blockErrorPageDescription"
    block_error_page_message: "blockErrorPageMessage"
    block_response_code: 403
    captcha_footer: "captchaFooter"
    captcha_header: "captchaHeader"
    captcha_submit_label: "captchaSubmitLabel"
    captcha_title: "captchaTitle"

  failure_threshold: 10
  failure_threshold_expiration_in_seconds: 10
  interaction_threshold: 10
  recording_period_in_seconds: 10

  set_http_header:
    name: "hc_name1"
    value: "hc_value1"

waf_config_js_challenge:
  is_enabled: True
  action: "DETECT"
  action_expiration_in_seconds: 10

  challenge_settings:
    block_action: "SET_RESPONSE_CODE"
    block_error_page_code: "403"
    block_error_page_description: "blockErrorPageDescription"
    block_error_page_message: "blockErrorPageMessage"
    block_response_code: 403
    captcha_footer: "captchaFooter"
    captcha_header: "captchaHeader"
    captcha_submit_label: "captchaSubmitLabel"
    captcha_title: "captchaTitle"

  failure_threshold: 10

waf_config_protection_settings:
  allowed_http_methods:
    - OPTIONS
    - HEAD
  block_action: "SET_RESPONSE_CODE"
  block_error_page_code: "403"
  block_error_page_description: "blockErrorPageDescription"
  block_error_page_message: "blockErrorPageMessage"
  block_response_code: 403
  is_response_inspected: False
  max_argument_count: 10
  max_name_length_per_argument: 10
  max_response_size_in_ki_b: 10
  max_total_name_length_of_arguments: 10
  media_types:
    - application/plain
    - application/json
  recommendations_period_in_days: 10

waf_config_whitelists:
  - addresses:
      - "192.168.127.127"
      - "192.168.127.128"
    name: whitelist_name


# updated values
updated_waf_config_access_rules:
- action: "ALLOW"
  criteria:
  - condition: "URL_IS"
    value: "/updated"
  name: "ansibletestaccessrule"
  block_action: "SET_RESPONSE_CODE"
  block_error_page_code: "403"
  block_error_page_description: "updatedblockErrorPageDescription"
  block_error_page_message: "updatedblockErrorPageMessage"
  block_response_code: 403

updated_waf_config_address_rate_limiting:
  is_enabled: True
  allowed_rate_per_address: 15
  max_delayed_count_per_address: 20

updated_waf_config_captchas:
  - failure_message: "updatedmessage"
    session_expiration_in_seconds: 100
    submit_label: "updatedlabel"
    title: "updatedtitle"
    url: "url"
    footer_text: "updated_footer_text"
    header_text: "updatedheader_text"

updated_waf_config_device_fingerprint_challenge:
  is_enabled: True
  action: "DETECT"

  challenge_settings:
    block_action: "SET_RESPONSE_CODE"
    block_error_page_description: "updatedblockErrorPageDescription"
    block_error_page_message: "updatedblockErrorPageMessage"
    captcha_footer: "updatedcaptchaFooter"
    captcha_header: "updatedcaptchaHeader"
    captcha_submit_label: "updatedcaptchaSubmitLabel"
    captcha_title: "updatedcaptchaTitle"

  failure_threshold: 20
  failure_threshold_expiration_in_seconds: 20
  max_address_count: 20
  max_address_count_expiration_in_seconds: 20

updated_waf_config_human_interaction_challenge:
  is_enabled: True
  action: "DETECT"

  challenge_settings:
    block_action: "SET_RESPONSE_CODE"
    block_error_page_code: "403"
    block_error_page_description: "updatedblockErrorPageDescription"
    block_error_page_message: "updatedblockErrorPageMessage"
    block_response_code: 403
    captcha_footer: "updatedcaptchaFooter"
    captcha_header: "updatedcaptchaHeader"
    captcha_submit_label: "updatedcaptchaSubmitLabel"
    captcha_title: "updatedcaptchaTitle"

  failure_threshold: 20
  failure_threshold_expiration_in_seconds: 20
  interaction_threshold: 20
  recording_period_in_seconds: 20

  set_http_header:
    name: "updated_hc_name1"
    value: "updated_hc_value1"

updated_waf_config_js_challenge:
  is_enabled: True
  action: "DETECT"
  action_expiration_in_seconds: 20

  challenge_settings:
    block_action: "SET_RESPONSE_CODE"
    block_error_page_code: "403"
    block_error_page_description: "updatedblockErrorPageDescription"
    block_error_page_message: "updatedblockErrorPageMessage"
    block_response_code: 403
    captcha_footer: "updatedcaptchaFooter"
    captcha_header: "updatedcaptchaHeader"
    captcha_submit_label: "updatedcaptchaSubmitLabel"
    captcha_title: "updatedcaptchaTitle"

  failure_threshold: 10

updated_waf_config_protection_settings:
  allowed_http_methods:
    - GET
  block_action: "SET_RESPONSE_CODE"
  block_error_page_code: "403"
  block_error_page_description: "updatedblockErrorPageDescription"
  block_error_page_message: "updatedblockErrorPageMessage"
  max_argument_count: 20
  max_name_length_per_argument: 20
  max_response_size_in_ki_b: 20
  max_total_name_length_of_arguments: 20
  media_types:
    - application/plain
    - application/json
    - text/html
    - text/plain
  recommendations_period_in_days: 5

updated_waf_config_whitelists:
  - addresses:
      - "192.168.127.100"
      - "192.168.127.101"
    name: "whitelist_name"

# admin user variables
test_admin_user_name: "ansible_test_admin_user_{{random_suffix_1024}}"

admin_user_group: "Administrators"

# API signing keys
# test_admin_user_creds_path is created in tasks/main.yaml
test_admin_user_api_key_pub_key_path: "{{test_admin_user_creds_path}}/api_signing_key_{{random_suffix_1024}}.pem"
test_admin_user_api_key_private_key_path: "{{test_admin_user_creds_path}}/api_signing_key_private_{{random_suffix_1024}}.pem"
test_admin_user_api_key_passphrase: "ansible"